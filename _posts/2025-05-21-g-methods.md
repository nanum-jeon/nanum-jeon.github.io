---
title: Replications for Introduction to g-methods
output:
  md_document:
    variant: gfm+footnotes
    preserve_yaml: TRUE
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../_posts") })
date: 2024-05-21
permalink: /posts/2024/05/g-methods
excerpt_separator: <!--more-->
always_allow_html: true
toc: true
header:
  og_image: "posts/g-methods/time_chart.png"
tags:
  - tutorial
  - causality
---

This tutorial aims to replicate the g-methods explained in [this paper](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6074945/) by Naimi, A. I., Cole, S. R., and Kennedy, E. H (2017) using R. Originally, the paper used SAS to demonstrate g-methods.

<!--more-->

In this paper, the empirical setting is to treat HIV with a therapy regimen ($$A$$) in two time periods ($$t = 0, t = 1$$). Additionally, we measure the time-varying confounder, HIV viral load ($$Z$$) at times $$t = 0$$ and $$t = 1$$. Note that this time-varying confounder is measured prior to the treatment administered at each time period. Also, we assume Z at time 0 is 1 for all subjects. Our outcome is the CD4 count (cells/mm) observed at $$t = 2$$.

In other words, we will have 

<img src="/images/posts/g-methods/time_chart.png" style="display: block; margin: auto;" />

``` r
library(tidyverse)
```

We' will begin with the standard linear regression to peak the crude differences between always-treated and never-treated in their outcome. 

```r
# Replication

# Data in Table 1 
# A0: Treatment at time 0 (for HIV)
# A1: HIV viral load prior to time 1 (Higher -> More HIV)
# A1: Treatment at time 1
# Y: Mean of CD4 count (cells/mm)
# N: Number of subjects 


a0 <- c(0, 0, 0, 0, 1, 1, 1, 1)
z1 <- c(0, 0, 1, 1, 0, 0, 1, 1)
a1 <- c(0, 1, 0, 1, 0, 1, 0, 1)
y <- c(87.288, 112.107, 119.654, 144.842, 105.282, 130.184, 137.720, 162.832)
n <- c(209271, 93779, 60657, 136293, 134781, 60789, 93903, 210527)

data <- data.frame(a0, z1, a1, y, n)
```

Now, we fit the data with standard linear regression models to replicate Table 2. 

```r
# Section 1
# Standard linear regression models in Table 2 
# Not considering standard error estimation 

# Crude model 
lm(y ~ a0 + a1 + a0*a1, data = data, weights = n)
```

## Call:
## lm(formula = y ~ a0 + a1 + a0 * a1, data = data, weights = n)
## 
## Coefficients:
## (Intercept)           a0           a1        a0:a1  
##     94.5611      24.0407      36.9378      -0.0225

```r
# Z-Adjusted model 
lm(y ~ a0 + a1 + a0*a1 + z1, data = data, weights = n)
```
 
## Call:
## lm(formula = y ~ a0 + a1 + a0 * a1 + z1, data = data, weights = n)
## 
## Coefficients:
## (Intercept)           a0           a1           z1        a0:a1  
##    87.24660     17.98931     24.96985     32.55024      0.05409

```r
# A0 only model 
lm(y ~ a0, data = data, weights = n)
```

## Call:
## lm(formula = y ~ a0, data = data, weights = n)
## 
## Coefficients:
## (Intercept)           a0  
##      111.56        27.08

```r
# Z1-Adjusted A0 Only Model
lm(y ~ a0 + z1, data = data, weights = n)
```
## Call:
## lm(formula = y ~ a0 + z1, data = data, weights = n)
## 
## Coefficients:
## (Intercept)           a0           z1  
##       94.98        18.03        42.09

```r
# A1 Only Model
lm(y ~ a1, data = data, weights = n)
```

## Call:
## lm(formula = y ~ a1, data = data, weights = n)
## 
## Coefficients:
## (Intercept)           a1  
##      105.59        38.91

```r
# Z1-Adjusted A1 Only Model
lm(y ~ a1 + z1, data = data, weights = n)
```
## Call:
## lm(formula = y ~ a1 + z1, data = data, weights = n)
## 
## Coefficients:
## (Intercept)           a1           z1  
##       94.30        25.01        36.42


[^1]: Naimi, A. I., Cole, S. R., & Kennedy, E. H. (2017). An introduction to g methods. International journal of epidemiology, 46(2), 756-762.


